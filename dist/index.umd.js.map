{"version":3,"file":"index.umd.js","sources":["../src/apis.ts","../src/providers/ProductHomeProvider.tsx","../src/utils.ts","../src/hooks/useEvents.ts","../src/hooks/useFeature.ts"],"sourcesContent":["import {AnalyticsRequest, IdentityAnalyticsRequest, ProductHouseFeature} from \"./Types\";\n\nconst baseUrl = \"https://product-server-chc1.onrender.com\"\n\n// todo neeed to handle no internet connection - queue?\nexport const postEvent = async (event: AnalyticsRequest) => {\n\n    const url = baseUrl + \"/v1/api/e\";\n    try {\n        await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(event)\n        });\n        // const result = await response.json();\n        // setResponse(result);\n    } catch (error) {\n        console.error(\"here\", error)\n        // setError(error.toString());\n        console.warn(\"Failed to send event\", error)\n    }\n\n}\nexport const postIdentity = async (event: IdentityAnalyticsRequest) => {\n\n    const url = baseUrl + \"/v1/api/i\";\n    try {\n        await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(event)\n        });\n        // const result = await response.json();\n        // setResponse(result);\n    } catch (error) {\n        console.error(\"here\", error)\n        // setError(error.toString());\n        console.warn(\"Failed to send event\", error)\n    }\n\n}\n\n\nexport const getFeatures = (): ProductHouseFeature[] => {\n    // add queryParam with base 64 context - key,user etc.\n    return []\n}\n","// MyProvider.tsx\nimport React, {createContext, ReactNode, useState} from 'react';\nimport {v4 as uuidv4} from 'uuid';\nimport {postIdentity} from \"src/apis\";\nimport {EventProperties, IdentityAnalyticsRequest} from \"src/Types\";\n\ninterface MyContextProps {\n    publicKey?: string;\n    userId?: string;\n    anonymousId?: string;\n    identity?: (userId: string, properties?: EventProperties) => void;\n}\n\nexport const ProductHouseContext = createContext<MyContextProps>({});\n\n// todo need to verify origin + publicKey\ninterface ProductHomeProviderProps {\n    publicKey: string;\n    children: ReactNode;\n}\n\nlet anonymousId = \"\";\nif (localStorage.getItem(\"p_a_id\")) {\n    anonymousId = localStorage.getItem(\"p_a_id\") as string;\n} else {\n    anonymousId = uuidv4();\n    localStorage.setItem(\"p_a_id\", anonymousId);\n}\nexport const ProductHomeProvider: React.FC<ProductHomeProviderProps> = ({\n                                                                            children,\n                                                                            publicKey\n                                                                        }: ProductHomeProviderProps) => {\n    const [userId, setUserId] = useState<string>();\n\n\n    const identity = (userId: string, properties?: EventProperties) => {\n        setUserId(userId)\n        const data: IdentityAnalyticsRequest = {\n            user_id: userId,\n            properties,\n            anonymous_id: anonymousId,\n            key: publicKey as string\n        }\n        postIdentity(data)\n            .then()\n            .catch()\n    }\n\n    return (\n        <ProductHouseContext.Provider value={{publicKey, userId, identity, anonymousId}}>\n            {children}\n        </ProductHouseContext.Provider>\n    );\n};\n","\n\nexport const buildEventName = (context:string,featureName:string,resource:string,action:string)=>{\n    return `${featureName}:${resource}:${action}`\n}","// useMyFeature.ts\nimport {useContext} from 'react';\nimport {ProductHouseContext} from '../providers/ProductHomeProvider';\nimport {AnalyticsRequest, EventProperties, IdentityAnalyticsRequest} from \"../Types\";\nimport {postEvent} from \"../apis\";\nimport {buildEventName} from \"../utils\";\n\nexport const useEvents = () => {\n    const {publicKey, userId, anonymousId, identity} = useContext(ProductHouseContext);\n\n    const featureFlag = false;\n    const triggerEvent = (eventId: string, properties: EventProperties, featureId?: string) => {\n\n        const data: AnalyticsRequest = {\n            event_id: eventId,\n            feature_id: featureId,\n            properties,\n            user_id: userId,\n            anonymous_id: anonymousId,\n            key: publicKey as string\n        }\n        postEvent(data)\n            .then()\n            .catch()\n    }\n\n    return {identity, triggerEvent, buildEventName};\n\n};\n\n","import {useContext} from 'react';\nimport {ProductHouseContext} from '../providers/ProductHomeProvider';\nimport {AnalyticsRequest, EventProperties} from \"../Types\";\nimport {buildEventName} from \"../utils\";\nimport {postEvent} from \"../apis\";\n\nexport const useFeature = (featureId: string) => {\n    const {publicKey, userId, identity, anonymousId} = useContext(ProductHouseContext);\n    const featureFlag = true;\n\n    const triggerEvent = (eventId: string, properties: EventProperties) => {\n        console.log(\"triggering event\")\n        const data: AnalyticsRequest = {\n            event_id: eventId,\n            feature_id: featureId,\n            properties,\n            user_id: userId,\n            anonymous_id: anonymousId,\n            key: publicKey as string\n        }\n        postEvent(data)\n            .then()\n            .catch()\n    }\n\n    return {featureFlag, triggerEvent, buildEventName, identity};\n\n};\n\n"],"names":["baseUrl","postEvent","event","url","_temp","_catch","Promise","resolve","fetch","method","headers","body","JSON","stringify","then","error","console","warn","e","reject","ProductHouseContext","createContext","anonymousId","localStorage","getItem","uuidv4","setItem","buildEventName","context","featureName","resource","action","_ref","children","publicKey","_useState","useState","setUserId","React","Provider","value","userId","identity","properties","_temp2","postIdentity","user_id","anonymous_id","key","_useContext","useContext","triggerEvent","eventId","featureId","event_id","feature_id","featureFlag","log"],"mappings":"keAEA,IAAMA,EAAU,2CAGHC,EAAA,SAAmBC,GAAuB,IAEnD,IAAMC,EAAMH,EAAU,YAAYI,EAAAC,EAAA,WAC9BC,OAAAA,QAAAC,QACMC,MAAML,EAAK,CACbM,OAAQ,OACRC,QAAS,CACL,eAAgB,oBAEpBC,KAAMC,KAAKC,UAAUX,MACvBY,KAGL,WAAA,EAAA,EAAQC,SAAAA,GACLC,QAAQD,MAAM,OAAQA,GAEtBC,QAAQC,KAAK,uBAAwBF,EACxC,UAAAT,QAAAC,QAAAH,GAAAA,EAAAU,KAAAV,EAAAU,KAEL,mBAAA,EAAA,CAAC,MAAAI,UAAAZ,QAAAa,OAAAD,EAAA,CAAA,ECXYE,EAAsBC,EAAAA,cAA8B,CAAA,GAQ7DC,EAAc,GACdC,aAAaC,QAAQ,UACrBF,EAAcC,aAAaC,QAAQ,WAEnCF,EAAcG,EAAAA,KACdF,aAAaG,QAAQ,SAAUJ,IAEtB,IC1BAK,EAAiB,SAACC,EAAeC,EAAmBC,EAAgBC,GAC7E,OAAUF,EAAeC,IAAAA,EAAYC,IAAAA,CACzC,wBDwBuE,SAAvCC,GAC4C,IAAAC,EAAQD,EAARC,SACAC,EAASF,EAATE,UAExEC,EAA4BC,aAAbC,EAASF,EAGxB,GAaA,OACIG,wBAAClB,EAAoBmB,SAAS,CAAAC,MAAO,CAACN,UAAAA,EAAWO,OAjBxCN,KAiBgDO,SAd5C,SAACD,EAAgBE,GAC9BN,EAAUI,GDXO,SAAUvC,GAAmC,IAElE,IAAMC,EAAMH,EAAU,YAAY4C,EAAAvC,EAC9B,WAAA,OAAAC,QAAAC,QACMC,MAAML,EAAK,CACbM,OAAQ,OACRC,QAAS,CACL,eAAgB,oBAEpBC,KAAMC,KAAKC,UAAUX,MACvBY,KAAA,WAAA,EAGL,EAAA,SAAQC,GACLC,QAAQD,MAAM,OAAQA,GAEtBC,QAAQC,KAAK,uBAAwBF,EACxC,GAAA,OAAAT,QAAAC,QAAAqC,GAAAA,EAAA9B,KAAA8B,EAAA9B,KAAA,WAAA,QAAA,EAEL,CAAC,MAAAI,GAAA,OAAAZ,QAAAa,OAAAD,EAGD,CAAA,CCJQ2B,CANuC,CACnCC,QAASL,EACTE,WAAAA,EACAI,aAAczB,EACd0B,IAAKd,IAGJpB,OACK,OACd,EAGuEQ,YAAAA,IAC9DW,EAGb,cE9CyB,WACrB,IAAAgB,EAAmDC,EAAUA,WAAC9B,GAAvDc,EAASe,EAATf,UAAWO,EAAMQ,EAANR,OAAQnB,EAAW2B,EAAX3B,YAkB1B,MAAO,CAACoB,SAlBuCO,EAARP,SAkBrBS,aAfG,SAACC,EAAiBT,EAA6BU,GAUhEpD,EAR+B,CAC3BqD,SAAUF,EACVG,WAAYF,EACZV,WAAAA,EACAG,QAASL,EACTM,aAAczB,EACd0B,IAAKd,IAGJpB,cAET,EAEgCa,eAAAA,EAEpC,eCtB0B,SAAC0B,GACvB,IAAAJ,EAAmDC,EAAUA,WAAC9B,GAAvDc,EAASe,EAATf,UAAWO,EAAMQ,EAANR,OAAkBnB,EAAW2B,EAAX3B,YAkBpC,MAAO,CAACkC,aAjBY,EAiBCL,aAfA,SAACC,EAAiBT,GACnC3B,QAAQyC,IAAI,oBASZxD,EAR+B,CAC3BqD,SAAUF,EACVG,WAAYF,EACZV,WAAAA,EACAG,QAASL,EACTM,aAAczB,EACd0B,IAAKd,IAGJpB,OACK,OACd,EAEmCa,eAAAA,EAAgBe,SAlBjBO,EAARP,SAoB9B"}